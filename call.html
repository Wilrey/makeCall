<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phone Number Verification</title>
  <style>
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <form id="login">
      <p>Enter your phone number (E.164 format):</p>
      <p>Will place a call on behalf of queue: WF ATC id:07b54d9e-b08b-4587-a4bd-7e0055ebed0b</p>
      <input id="phone" type="tel" name="phone" required>
      <input type="submit" class="btn" value="Verify">
    </form>
    <div class="alert hidden"></div>
  </div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
  <script>
    const form = document.querySelector("#login");
    const phoneInput = document.querySelector("#phone");
    const info = document.querySelector(".alert");
      const ENVIRONMENT = 'mypurecloud.de';

    form.addEventListener("submit", process);
  function getParameterByName(name) {
    name = name.replace(/[\\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\#&]" + name + "=([^&#]*)"),
      results = regex.exec(location.hash);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }
    
    function process(event) {
      event.preventDefault();
      const phoneNumber = phoneInput.value;
      const queue = '07b54d9e-b08b-4587-a4bd-7e0055ebed0b';
      
      info.classList.remove("hidden");
      info.innerHTML = `Placing call to Phone number in E.164 format: <strong>${phoneNumber}</strong>`;
      placeCall(phoneNumber,queue);
    }

function placeCall(phone,queue){
        var token = getParameterByName('access_token');
    $.ajax({
      url: `https://api.${ENVIRONMENT}/api/v2/conversations/calls`,
      type: "post",
      data: {"callFromQueueId": queue,"phoneNumber": phone},
      contentType:"application/json; charset=utf-8",
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', 'bearer ' + token);
      },
      success: function(data) {
        console.log(data);
      }
    });
}
  </script>
</body>
</html>
