<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Genesys Cloud API Demo</title>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>

<h1>Genesys Cloud API Demo</h1>

<table border="1">
  <thead>
    <tr>
      <th>Queue ID</th>
      <th>Media Type</th>
      <th>Interactions</th>
      <th>Waiting</th>
      <th>Longest Waiting</th>
      <th>Agents in Queue</th>
    </tr>
  </thead>
  <tbody id="queueData"></tbody>
</table>

<script>
	    
      const CLIENT_ID = 'ee4696b8-16c4-40ce-87ae-7322597880ac';
      const ENVIRONMENT = 'mypurecloud.de';
	const REDIRECT_URI = 'https://wilrey.github.io/test/index.html';

  function getParameterByName(name) {
    name = name.replace(/[\\[]/, "\\[").replace(/[\]]/, "\\]");
    var regex = new RegExp("[\\#&]" + name + "=([^&#]*)"),
      results = regex.exec(location.hash);
    return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
  }

      function process(event) {
        event.preventDefault();
        const phoneNumber = phoneInput.value;
        const queue = '07b54d9e-b08b-4587-a4bd-7e0055ebed0b';
        info.innerHTML = `Placing call to Phone number in E.164 format: <strong>${phoneNumber}</strong>`;
        placeCall(phoneNumber, queue);
      }

  if (window.location.hash) {
    console.log(location.hash);
    var token = getParameterByName('access_token');

    $.ajax({
      url: `https://api.${ENVIRONMENT}/api/v2/users/me`,
      type: 'GET',
      beforeSend: function(xhr) {
        xhr.setRequestHeader('Authorization', 'Bearer ' + token);
      },
      success: function(data) {
        displayUserData(data);
      }
    });

    location.hash = '';
  } else {
    var queryStringData = {
      response_type: 'token',
      client_id: CLIENT_ID,
      redirect_uri: REDIRECT_URI
    };

    window.location.replace(`https://login.${ENVIRONMENT}/oauth/authorize?` + jQuery.param(queryStringData));
  }

	 function displayQueueData(queueData) {
    const queueDataElement = $('#queueData');
    queueDataElement.empty();

    queueData.results.forEach(result => {
      const group = result.group;
      const rowData = result.data;

      rowData.forEach(metricData => {
        const row = `<tr>
                      <td>${group.queueId || ''}</td>
                      <td>${group.mediaType || ''}</td>
                      <td>${metricData.metric === 'oInteracting' ? metricData.stats.count : ''}</td>
                      <td>${metricData.metric === 'oWaiting' ? metricData.stats.count : ''}</td>
                      <td>${metricData.metric === 'oWaiting' && metricData.stats.count > 0 ? 'N/A' : ''}</td>
                      <td>${metricData.metric === 'oMemberUsers' ? metricData.stats.count : ''}</td>
                    </tr>`;
        queueDataElement.append(row);
      });
    });
  }
	
</script>
</body>
</html>
